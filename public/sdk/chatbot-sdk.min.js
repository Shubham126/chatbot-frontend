var ChatFlowSDK=function(t){"use strict";function e(t,e,n,a,r,o,i){try{var s=t[o](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(a,r)}function n(t){return function(){var n=this,a=arguments;return new Promise(function(r,o){var i=t.apply(n,a);function s(t){e(i,r,o,s,c,"next",t)}function c(t){e(i,r,o,s,c,"throw",t)}s(void 0)})}}function a(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,c(a.key),a)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e,n){return(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function i(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,e,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var i=a&&a.prototype instanceof l?a:l,h=Object.create(i.prototype);return s(h,"_invoke",function(n,a,r){var o,i,s,l=0,h=r||[],u=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return o=e,i=0,s=t,d.n=n,c}};function p(n,a){for(i=n,s=a,e=0;!u&&l&&!r&&e<h.length;e++){var r,o=h[e],p=d.p,b=o[2];n>3?(r=b===a)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=t):o[0]<=p&&((r=n<2&&p<o[1])?(i=0,d.v=a,d.n=o[1]):p<b&&(r=n<3||o[0]>a||a>b)&&(o[4]=n,o[5]=a,d.n=b,i=0))}if(r||n>1)return c;throw u=!0,a}return function(r,h,b){if(l>1)throw TypeError("Generator is already running");for(u&&1===h&&p(h,b),i=h,s=b;(e=i<2?t:s)||!u;){o||(i?i<3?(i>1&&(d.n=-1),p(i,s)):d.n=s:d.v=s);try{if(l=2,o){if(i||(r="next"),e=o[r]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,i<2&&(i=0)}else 1===i&&(e=o.return)&&e.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),i=1);o=t}else if((e=(u=d.n<0)?s:n.call(a,d))!==c)break}catch(e){o=t,i=1,s=e}finally{l=1}}return{value:e,done:u}}}(n,r,o),!0),h}var c={};function l(){}function h(){}function u(){}e=Object.getPrototypeOf;var d=[][a]?e(e([][a]())):(s(e={},a,function(){return this}),e),p=u.prototype=l.prototype=Object.create(d);function b(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,s(t,r,"GeneratorFunction")),t.prototype=Object.create(p),t}return h.prototype=u,s(p,"constructor",u),s(u,"constructor",h),h.displayName="GeneratorFunction",s(u,r,"GeneratorFunction"),s(p),s(p,r,"Generator"),s(p,a,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m:b}})()}function s(t,e,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}s=function(t,e,n,a){if(e)r?r(t,e,{value:n,enumerable:!a,configurable:!a,writable:!a}):t[e]=n;else{function o(e,n){s(t,e,function(t){return this._invoke(e,n,t)})}o("next",0),o("throw",1),o("return",2)}},s(t,e,n,a)}function c(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}var l=function(){return a(function t(e){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.apiKey=e;var i="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("127.0.0.1")?"http://localhost:3000/api/scrape":"https://chatbot-backend-srhg.onrender.com/api/scrape";this.baseUrl=a.baseUrl||i,this.isOpen=!1,this.currentFileId=null,this.chatHistory=[],this.selectedFileId=null,this.selectedSiteName=null,this.websiteTheme=null,this.options=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({position:"bottom-right",theme:"default",themeStyle:"auto",title:"ChatFlow AI Assistant",placeholder:"Ask me anything about this website...",preselectedSite:null},a),this.init(),this.setupConfigRefresh(),window.ChatFlowRefresh=function(){n.refreshConfiguration()}},[{key:"setupConfigRefresh",value:function(){var t=this;this.configRefreshInterval=setInterval(n(i().m(function e(){return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t.refreshConfiguration();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])})),2e3),document.addEventListener("visibilitychange",function(){document.hidden||t.refreshConfiguration()}),window.addEventListener("focus",function(){t.refreshConfiguration()})}},{key:"refreshConfiguration",value:(p=n(i().m(function t(){var e,n,a,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,e=(new Date).getTime(),t.n=1,fetch("".concat(this.baseUrl,"/sdk-config?t=").concat(e),{method:"GET",headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});case 1:return n=t.v,t.n=2,n.json();case 2:if(!(a=t.v).success||!a.data){t.n=4;break}if(r=a.data,!this.hasConfigurationChanged(r)){t.n=4;break}return t.n=3,this.applyNewConfiguration(r);case 3:this.showUpdateNotification();case 4:t.n=6;break;case 5:t.p=5,t.v;case 6:return t.a(2)}},t,this,[[0,5]])})),function(){return p.apply(this,arguments)})},{key:"hasConfigurationChanged",value:function(t){var e,n,a,r;if(!this.sdkConfig)return!0;if((null===(e=this.sdkConfig.selectedWebsite)||void 0===e?void 0:e.id)!==(null===(n=t.selectedWebsite)||void 0===n?void 0:n.id))return!0;var o=null===(a=this.sdkConfig.integration)||void 0===a?void 0:a.themeChoice,i=null===(r=t.integration)||void 0===r?void 0:r.themeChoice;if(o!==i)return!0;if("website"===i&&JSON.stringify(this.sdkConfig.themeData||{})!==JSON.stringify(t.themeData||{}))return!0;return!1}},{key:"applyNewConfiguration",value:(d=n(i().m(function t(e){var n,a,r,o;return i().w(function(t){for(;;)switch(t.n){case 0:this.sdkConfig=e,e.integration.customizations&&((n=e.integration.customizations).position&&n.position!==this.options.position&&(this.options.position=n.position,this.widget.className="chatbot-widget ".concat(this.options.position)),n.title&&n.title!==this.options.title&&(this.options.title=n.title,(a=this.widget.querySelector(".chatbot-title"))&&(a.textContent=n.title)),n.placeholder&&n.placeholder!==this.options.placeholder&&(this.options.placeholder=n.placeholder,(r=this.widget.querySelector("#chatbot-input"))&&!r.disabled&&(r.placeholder=n.placeholder))),"website"===e.integration.themeChoice&&e.themeData?(this.options.themeStyle="website",this.websiteTheme=e.themeData):(this.options.themeStyle="default",this.websiteTheme=null),e.selectedWebsite?(this.currentFileId=e.selectedWebsite.id,this.enableInput(),this.clearChat()):e.availableWebsites.length>0?(o=e.availableWebsites[0],this.currentFileId=o.id,this.enableInput(),this.clearChat()):this.showNoSitesMessage(),this.createStyles();case 1:return t.a(2)}},t,this)})),function(t){return d.apply(this,arguments)})},{key:"showUpdateNotification",value:function(){}},{key:"init",value:(u=n(i().m(function t(){return i().w(function(t){for(;;)switch(t.n){case 0:return this.createStyles(),this.createChatWidget(),this.bindEvents(),t.n=1,this.validateApiKey();case 1:if(!t.v){t.n=3;break}return t.n=2,this.loadSdkConfiguration();case 2:t.n=4;break;case 3:this.showApiKeyError();case 4:return t.a(2)}},t,this)})),function(){return u.apply(this,arguments)})},{key:"validateApiKey",value:(h=n(i().m(function t(){var e,n;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("".concat(this.baseUrl.replace("/scrape",""),"/auth/validate-api-key"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});case 1:return e=t.v,t.n=2,e.json();case 2:return n=t.v,t.a(2,n.success);case 3:return t.p=3,t.v,t.a(2,!1)}},t,this,[[0,3]])})),function(){return h.apply(this,arguments)})},{key:"showApiKeyError",value:function(){this.widget.querySelector("#chatbot-messages").innerHTML='\n            <div class="chatbot-message bot" style="background: #fef2f2; color: #dc2626; border: 1px solid #fecaca;">\n                <strong>Invalid API Key</strong><br>\n                The provided API key is invalid or has been revoked. Please check your integration settings and ensure you\'re using a valid API key.\n            </div>\n        ';var t=this.widget.querySelector("#chatbot-input"),e=this.widget.querySelector("#chatbot-send");t.disabled=!0,e.disabled=!0,t.placeholder="Invalid API key - chatbot disabled";var n=this.widget.querySelector("#chatbot-site-selector");n&&(n.style.display="none")}},{key:"createStyles",value:function(){var t=this.getThemeColors(),e="\n            :root {\n                --chatbot-primary: ".concat(t.primary,";\n                --chatbot-primary-dark: ").concat(t.primaryDark,";\n                --chatbot-primary-light: ").concat(t.primaryLight||t.primary,";\n                --chatbot-secondary: ").concat(t.secondary,";\n                --chatbot-background: ").concat(t.background,";\n                --chatbot-text: ").concat(t.text,";\n                --chatbot-border: ").concat(t.border,";\n                --chatbot-button: ").concat(t.button||t.primary,";\n                --chatbot-link: ").concat(t.link||t.primary,";\n                --chatbot-accent: ").concat(t.accent||t.primary,";\n                --chatbot-user-bg: ").concat(t.userBg,";\n                --chatbot-bot-bg: ").concat(t.botBg,";\n                --chatbot-header-bg: ").concat(t.headerBg||t.primary,";\n                --chatbot-header-text: ").concat(t.headerText||"#ffffff",";\n            }\n            .chatbot-widget {\n                position: fixed; z-index: 10000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n            .chatbot-widget.bottom-right { bottom: 20px; right: 20px; }\n            .chatbot-widget.bottom-left { bottom: 20px; left: 20px; }\n            .chatbot-widget.top-right { top: 20px; right: 20px; }\n            .chatbot-widget.top-left { top: 20px; left: 20px; }\n            .chatbot-toggle {\n                width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--chatbot-primary) 0%, var(--chatbot-primary-dark) 100%);\n                border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;\n            }\n            .chatbot-toggle svg { width: 24px; height: 24px; fill: white; }\n            .chatbot-widget .chatbot-container.open ~ .chatbot-toggle {\n                opacity: 0; visibility: hidden; transform: scale(0.8); pointer-events: none;\n            }\n            .chatbot-container {\n                position: absolute; bottom: 0; right: 0; width: 380px; height: 605px; background: var(--chatbot-background);\n                border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; flex-direction: column;\n                opacity: 0; visibility: hidden; transform: translateY(20px) scale(0.95); transition: all 0.3s ease; overflow: hidden;\n            }\n            .chatbot-container.open { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }\n            .chatbot-header {\n                background: linear-gradient(135deg, var(--chatbot-header-bg) 0%, var(--chatbot-primary-dark) 100%); color: var(--chatbot-header-text);\n                padding: 16px; display: flex; justify-content: center; align-items: center; border-radius: 12px 12px 0 0; position: relative;\n            }\n            .chatbot-title { font-weight: 600; font-size: 16px; color: var(--chatbot-header-text); text-align: center; flex: 1; }\n            .chatbot-close {\n                background: none; border: none; color: var(--chatbot-header-text); cursor: pointer; padding: 8px; border-radius: 6px;\n                opacity: 0.8; transition: all 0.2s ease; position: absolute; right: 12px; top: 50%; transform: translateY(-50%);\n            }\n            .chatbot-close:hover { background: rgba(255,255,255,0.15); opacity: 1; transform: translateY(-50%) scale(1.1); }\n            .chatbot-messages {\n                flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: var(--chatbot-background);\n            }\n            .chatbot-message { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.4; }\n            .chatbot-message.user { background: var(--chatbot-user-bg); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }\n            .chatbot-message.bot { background: var(--chatbot-bot-bg); color: var(--chatbot-text); align-self: flex-start; border-bottom-left-radius: 4px; }\n            .bot-message-content { line-height: 1.5; }\n            .bot-title {\n                font-size: 16px; font-weight: 600; color: var(--chatbot-text); margin: 8px 0 12px 0;\n                padding-bottom: 6px; border-bottom: 2px solid var(--chatbot-primary);\n            }\n            .bot-header { font-size: 14px; font-weight: 600; color: var(--chatbot-text); margin: 12px 0 8px 0; }\n            .bot-bullet { margin: 4px 0; padding-left: 8px; color: var(--chatbot-text); }\n            .bot-numbered { margin: 4px 0; padding-left: 8px; color: var(--chatbot-text); font-weight: 500; }\n            .bot-message-content strong { color: var(--chatbot-text); font-weight: 600; }\n            .bot-message-content br { line-height: 1.8; }\n            .chatbot-input-container {\n                padding: 16px; border-top: 1px solid var(--chatbot-border); display: flex; gap: 8px; background: var(--chatbot-background);\n            }\n            .chatbot-input {\n                flex: 1; padding: 12px 16px; border: 1px solid var(--chatbot-border); border-radius: 12px; outline: none; font-size: 14px;\n                background: var(--chatbot-background); color: var(--chatbot-text); resize: none; height: 20px; min-height: 20px; max-height: 20px;\n                line-height: 1.2; font-family: inherit; overflow-y: auto; overflow-x: hidden;\n            }\n            .chatbot-input:focus { border-color: var(--chatbot-primary); }\n            .chatbot-send {\n                width: 40px; height: 40px; border-radius: 50%; background: var(--chatbot-primary); border: none; cursor: pointer;\n                display: flex; align-items: center; justify-content: center; transition: background 0.2s;\n            }\n            .chatbot-send:hover { background: var(--chatbot-primary-dark); }\n            .chatbot-send:disabled { background: #adb5bd; cursor: not-allowed; }\n            .chatbot-send svg { width: 16px; height: 16px; fill: white; }\n            .chatbot-loading-inline {\n                display: flex; align-items: center; gap: 8px; color: var(--chatbot-text); font-size: 14px; opacity: 0.8;\n            }\n            .chatbot-loading-dots { display: flex; gap: 4px; }\n            .chatbot-loading-dot {\n                width: 6px; height: 6px; border-radius: 50%; background: var(--chatbot-primary); animation: chatbot-pulse 1.4s ease-in-out infinite both;\n            }\n            .chatbot-loading-dot:nth-child(1) { animation-delay: -0.32s; }\n            .chatbot-loading-dot:nth-child(2) { animation-delay: -0.16s; }\n            @keyframes chatbot-pulse { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }\n            .chatbot-status { padding: 8px 16px; background: #e3f2fd; color: #1976d2; font-size: 12px; text-align: center; }\n            .chatbot-site-subtitle { font-size: 12px; color: rgba(255, 255, 255, 0.8); margin-top: 2px; font-weight: 400; }\n            \n            /* Enhanced Markdown Styling */\n            .bot-message-content { line-height: 1.6; }\n            .bot-paragraph { margin: 8px 0; }\n            .bot-header { font-size: 18px; font-weight: 600; color: var(--chatbot-text); margin: 16px 0 8px 0; padding-bottom: 4px; border-bottom: 2px solid var(--chatbot-primary); }\n            .bot-subheader { font-size: 16px; font-weight: 600; color: var(--chatbot-text); margin: 12px 0 6px 0; }\n            .bot-bold { font-weight: 600; color: var(--chatbot-text); }\n            .bot-italic { font-style: italic; color: var(--chatbot-text); }\n            .bot-link { color: var(--chatbot-link); text-decoration: none; border-bottom: 1px solid transparent; transition: all 0.2s ease; }\n            .bot-link:hover { border-bottom-color: var(--chatbot-link); text-decoration: none; }\n            .bot-list, .bot-numbered-list { margin: 8px 0; padding-left: 20px; }\n            .bot-list-item { margin: 4px 0; color: var(--chatbot-text); line-height: 1.5; }\n            .bot-table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 14px; }\n            .bot-table-header { background: var(--chatbot-primary); color: white; padding: 8px 12px; text-align: left; font-weight: 600; }\n            .bot-table-cell { padding: 8px 12px; border: 1px solid var(--chatbot-border); color: var(--chatbot-text); }\n            .bot-table tbody tr:nth-child(even) { background: rgba(0, 0, 0, 0.02); }\n        "),n=document.getElementById("chatbot-styles");n&&n.remove();var a=document.createElement("style");a.id="chatbot-styles",a.textContent=e,document.head.appendChild(a)}},{key:"updateStyles",value:function(){this.createStyles()}},{key:"createChatWidget",value:function(){var t=document.createElement("div");t.className="chatbot-widget ".concat(this.options.position),t.innerHTML='\n            <button class="chatbot-toggle" id="chatbot-toggle">\n                <svg viewBox="0 0 24 24">\n                    <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n                </svg>\n            </button>\n            <div class="chatbot-container" id="chatbot-container">\n                <div class="chatbot-header">\n                    <div class="chatbot-title">'.concat(this.options.title,'</div>\n                    <button class="chatbot-close" id="chatbot-close">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n                        </svg>\n                    </button>\n                </div>\n                <div class="chatbot-messages" id="chatbot-messages">\n                    <div class="chatbot-message bot">\n                        Hi! I\'m your AI assistant. I\'ll help you with information from your scraped websites.\n                    </div>\n                </div>\n                <div class="chatbot-input-container">\n                    <textarea class="chatbot-input" id="chatbot-input" placeholder="').concat(this.options.placeholder,'" disabled rows="1"></textarea>\n                    <button class="chatbot-send" id="chatbot-send" disabled>\n                        <svg viewBox="0 0 24 24">\n                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n        '),document.body.appendChild(t),this.widget=t}},{key:"bindEvents",value:function(){var t=this,e=this.widget.querySelector("#chatbot-toggle"),n=this.widget.querySelector("#chatbot-close"),a=this.widget.querySelector("#chatbot-input"),r=this.widget.querySelector("#chatbot-send");e.addEventListener("click",function(){return t.toggleChat()}),n.addEventListener("click",function(){return t.closeChat()}),r.addEventListener("click",function(){return t.sendMessage()}),a.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.sendMessage())})}},{key:"toggleChat",value:function(){this.isOpen=!this.isOpen,this.widget.querySelector("#chatbot-container").classList.toggle("open",this.isOpen)}},{key:"closeChat",value:function(){this.isOpen=!1,this.widget.querySelector("#chatbot-container").classList.remove("open")}},{key:"enableInput",value:function(){var t=this.widget.querySelector("#chatbot-input"),e=this.widget.querySelector("#chatbot-send");t.disabled=!1,e.disabled=!1,t.placeholder=this.options.placeholder||"Ask me anything about this website...",t.focus()}},{key:"sendMessage",value:(l=n(i().m(function t(){var e,n,a,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=this.widget.querySelector("#chatbot-input"),(n=e.value.trim())&&this.currentFileId){t.n=1;break}return t.a(2);case 1:return this.addMessage(n,"user"),e.value="",this.showLoading(),t.p=2,t.n=3,fetch("".concat(this.baseUrl,"/chat"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey},body:JSON.stringify({fileId:this.currentFileId,message:n})});case 3:return a=t.v,t.n=4,a.json();case 4:r=t.v,this.hideLoading(),r.success?this.addMessage(r.data.response,"bot"):this.addMessage("Sorry, I encountered an error. Please try again.","bot"),t.n=6;break;case 5:t.p=5,t.v,this.hideLoading(),this.addMessage("Sorry, I encountered an error. Please try again.","bot");case 6:return t.a(2)}},t,this,[[2,5]])})),function(){return l.apply(this,arguments)})},{key:"addMessage",value:function(t,e){var n=this.widget.querySelector("#chatbot-messages"),a=document.createElement("div");a.className="chatbot-message ".concat(e),"bot"===e?a.innerHTML=this.formatBotMessage(t):a.textContent=t,n.appendChild(a),n.scrollTop=n.scrollHeight,this.chatHistory.push({text:t,sender:e,timestamp:new Date})}},{key:"formatBotMessage",value:function(t){if(!t||"string"!=typeof t)return"";var e=this.cleanupAIResponse(t);return e=this.processMarkdownLinks(e),e=(e=(e=this.escapeHtmlExceptLinks(e)).replace(/\n\n/g,'</p><p class="bot-paragraph">')).replace(/\n/g,"<br>"),e=(e=(e=this.processMarkdownHeaders(e)).replace(/\*\*(.*?)\*\*/g,'<strong class="bot-bold">$1</strong>')).replace(/\*(.*?)\*/g,'<em class="bot-italic">$1</em>'),e=this.processBulletPoints(e),e=this.processNumberedLists(e),(e=(e=(e=(e=this.processMarkdownTables(e)).replace(/<\/p><p class="bot-paragraph">\s*<\/p>/g,"</p>")).replace(/^<\/p>/,"")).replace(/<p class="bot-paragraph">\s*$/,"")).includes('<p class="bot-paragraph">')||(e='<p class="bot-paragraph">'.concat(e,"</p>")),'<div class="bot-message-content">'.concat(e,"</div>")}},{key:"cleanupAIResponse",value:function(t){return t.replace(/<[^>]*$/g,"").replace(/^[^<]*>/g,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").trim()}},{key:"processMarkdownLinks",value:function(t){return t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="bot-link">$1</a>')}},{key:"escapeHtmlExceptLinks",value:function(t){var e=this,n=/(<a[^>]*>.*?<\/a>)/g;return t.split(n).map(function(t){return n.test(t)?t:e.escapeHtml(t)}).join("")}},{key:"processMarkdownHeaders",value:function(t){return t=(t=t.replace(/##\s+(.+?)(<br>|$)/g,'<h3 class="bot-header">$1</h3><br>')).replace(/###\s+(.+?)(<br>|$)/g,'<h4 class="bot-subheader">$1</h4><br>')}},{key:"processBulletPoints",value:function(t){for(var e=t.split("<br>"),n=!1,a=[],r=0;r<e.length;r++){var o=e[r].trim();if(o.startsWith("• ")||o.startsWith("- ")){n||(a.push('</p><ul class="bot-list"><p class="bot-paragraph">'),n=!0);var i=(o.startsWith("• "),o.substring(2));a.push('<li class="bot-list-item">'.concat(i,"</li>"))}else n&&(a.push('</p></ul><p class="bot-paragraph">'),n=!1),o&&a.push(o)}return n&&a.push('</p></ul><p class="bot-paragraph">'),a.join("<br>")}},{key:"processNumberedLists",value:function(t){for(var e=t.split("<br>"),n=!1,a=[],r=0;r<e.length;r++){var o=e[r].trim();if(/^\d+\.\s/.test(o)){n||(a.push('</p><ol class="bot-numbered-list"><p class="bot-paragraph">'),n=!0);var i=o.replace(/^\d+\.\s/,"");a.push('<li class="bot-list-item">'.concat(i,"</li>"))}else n&&(a.push('</p></ol><p class="bot-paragraph">'),n=!1),o&&a.push(o)}return n&&a.push('</p></ol><p class="bot-paragraph">'),a.join("<br>")}},{key:"processMarkdownTables",value:function(t){for(var e=t.split("<br>"),n=[],a=!1,r=[],o=0;o<e.length;o++){var i=e[o].trim();if(i.includes("|")&&i.split("|").length>2){if(a||(a=!0,r=[]),i.includes("---")||i.includes("==="))continue;var s=i.split("|").map(function(t){return t.trim()}).filter(function(t){return t});r.push(s)}else a&&(n.push(this.renderTable(r)),a=!1,r=[]),i&&n.push(i)}return a&&n.push(this.renderTable(r)),n.join("<br>")}},{key:"renderTable",value:function(t){if(0===t.length)return"";var e='<table class="bot-table">';if(t.length>0&&(e+="<thead><tr>",t[0].forEach(function(t){e+='<th class="bot-table-header">'.concat(t,"</th>")}),e+="</tr></thead>"),t.length>1){e+="<tbody>";for(var n=1;n<t.length;n++)e+="<tr>",t[n].forEach(function(t){e+='<td class="bot-table-cell">'.concat(t,"</td>")}),e+="</tr>";e+="</tbody>"}return e+="</table>"}},{key:"escapeHtml",value:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"showLoading",value:function(){var t=this.widget.querySelector("#chatbot-messages"),e=document.createElement("div");e.className="chatbot-message bot",e.id="chatbot-loading",e.innerHTML='\n            <div class="bot-message-content">\n                <div class="chatbot-loading-inline">\n                    <span>AI is thinking</span>\n                    <div class="chatbot-loading-dots">\n                        <div class="chatbot-loading-dot"></div>\n                        <div class="chatbot-loading-dot"></div>\n                        <div class="chatbot-loading-dot"></div>\n                    </div>\n                </div>\n            </div>\n        ',t.appendChild(e),t.scrollTop=t.scrollHeight}},{key:"hideLoading",value:function(){var t=this.widget.querySelector("#chatbot-loading");t&&t.remove()}},{key:"showNoSitesMessage",value:function(){this.widget.querySelector("#chatbot-messages").innerHTML='\n            <div class="chatbot-message bot">\n                <div class="bot-message-content">\n                    <div class="bot-title">No websites available</div>\n                    <p>No scraped websites found for this API key. Please scrape some websites first using the dashboard.</p>\n                </div>\n            </div>\n        ';var t=this.widget.querySelector("#chatbot-input"),e=this.widget.querySelector("#chatbot-send");t&&(t.disabled=!0,t.placeholder="No websites available for chat"),e&&(e.disabled=!0)}},{key:"selectSite",value:(c=n(i().m(function t(e,n,a){return i().w(function(t){for(;;)switch(t.n){case 0:return this.currentFileId=e,this.enableInput(),this.clearChat(),t.n=1,this.autoDetectAndLoadTheme(e);case 1:case 2:return t.a(2)}},t,this)})),function(t,e,n){return c.apply(this,arguments)})},{key:"clearChat",value:function(){var t=this.widget.querySelector("#chatbot-messages"),e=this.currentFileId?"Hi! I'm ready to answer questions about the selected website. How can I help you?":"Hi! I'm your AI assistant. Please select a website from the dropdown above to start chatting about its content.";t.innerHTML='<div class="chatbot-message bot">'.concat(e,"</div>"),this.chatHistory=[]}},{key:"open",value:function(){this.isOpen=!0,this.widget.querySelector("#chatbot-container").classList.add("open")}},{key:"close",value:function(){this.closeChat()}},{key:"destroy",value:function(){this.configRefreshInterval&&clearInterval(this.configRefreshInterval),this.widget&&this.widget.remove()}},{key:"loadSdkConfiguration",value:(s=n(i().m(function t(){var e,n,a,r,o,s,c,l,h;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,e=(new Date).getTime(),t.n=1,fetch("".concat(this.baseUrl,"/sdk-config?t=").concat(e),{method:"GET",headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});case 1:return n=t.v,t.n=2,n.json();case 2:(a=t.v).success&&a.data?(r=a.data,this.sdkConfig=r,r.integration.customizations&&(o=r.integration.customizations,s=o.position,c=o.title,l=o.placeholder,s&&(this.options.position=s),c&&(this.options.title=c),l&&(this.options.placeholder=l)),"website"===r.integration.themeChoice&&r.themeData?(this.options.themeStyle="website",this.websiteTheme=r.themeData):this.options.themeStyle="default",r.selectedWebsite?(this.currentFileId=r.selectedWebsite.id,this.enableInput(),this.clearChat()):r.availableWebsites.length>0?(h=r.availableWebsites[0],this.currentFileId=h.id,this.enableInput(),this.clearChat()):this.showNoSitesMessage(),this.createStyles()):this.showNoSitesMessage(),t.n=4;break;case 3:t.p=3,t.v,this.showNoSitesMessage();case 4:return t.a(2)}},t,this,[[0,3]])})),function(){return s.apply(this,arguments)})},{key:"getThemeColors",value:function(){if("website"===this.options.themeStyle&&this.websiteTheme&&this.websiteTheme.colors){var t=this.websiteTheme.colors;if(!(t.primary&&this.isWebsiteSpecificColor(t.primary)))return this.getDefaultThemeColors();var e={primary:t.primary,primaryDark:this.darkenColor(t.primary,20),primaryLight:this.lightenColor(t.primary,20),secondary:t.secondary||this.adjustColorBrightness(t.primary,-15),background:t.background||"#ffffff",text:t.text||this.getContrastingTextColor(t.background||"#ffffff"),border:t.border||this.adjustColorBrightness(t.background||"#ffffff",-8),button:t.button||t.primary,link:t.link||t.primary,accent:t.accent||t.primary,userBg:t.primary,botBg:this.generateBotBackgroundColor(t),headerBg:t.primary,headerText:this.getContrastingTextColor(t.primary)};return this.ensureAccessibleColors(e)}return this.getDefaultThemeColors()}},{key:"getDefaultThemeColors",value:function(){return{primary:"#667eea",primaryDark:"#5a6fd8",primaryLight:"#7c8bf0",secondary:"#6c757d",background:"#ffffff",text:"#333333",border:"#dee2e6",button:"#667eea",link:"#667eea",accent:"#667eea",userBg:"#667eea",botBg:"#f1f3f5",headerBg:"#667eea",headerText:"#ffffff"}}},{key:"isWebsiteSpecificColor",value:function(t){if(!t)return!1;var e=t.toLowerCase().trim();return!["#ffffff","#fff","white","#000000","#000","black","#333333","#333","#666666","#666","#999999","#999","#cccccc","#ccc","#f0f0f0","#f5f5f5","#fafafa","#007bff","#0056b3","#0d6efd","#dc3545","#28a745","#ffc107","#17a2b8","#6c757d","#343a40","#667eea","#764ba2"].includes(e)&&(!this.isColorTooLight(e)&&!this.isColorTooDark(e)&&this.hasGoodSaturation(e))}},{key:"isColorTooLight",value:function(t){var e=t.replace("#","");return 6===e.length&&(.299*parseInt(e.substr(0,2),16)+.587*parseInt(e.substr(2,2),16)+.114*parseInt(e.substr(4,2),16))/255>.9}},{key:"isColorTooDark",value:function(t){var e=t.replace("#","");return 6===e.length&&(.299*parseInt(e.substr(0,2),16)+.587*parseInt(e.substr(2,2),16)+.114*parseInt(e.substr(4,2),16))/255<.1}},{key:"hasGoodSaturation",value:function(t){var e=t.replace("#","");if(6!==e.length)return!1;var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16),o=Math.max(n,a,r),i=Math.min(n,a,r);return(0===o?0:(o-i)/o)>.15}},{key:"generateBotBackgroundColor",value:function(t){return t.secondary&&t.secondary!==t.primary?this.lightenColor(t.secondary,60):t.primary?this.lightenColor(t.primary,75):"#f1f3f5"}},{key:"getContrastingTextColor",value:function(t){return this.isLightColor(t)?"#ffffff":"#2d3748"}},{key:"ensureAccessibleColors",value:function(t){return this.isLightColor(t.background)&&this.isLightColor(t.text)?t.text="#2d3748":this.isDarkColor(t.background)&&this.isDarkColor(t.text)&&(t.text="#f7fafc"),this.isLightColor(t.botBg)&&this.isLightColor(t.text)?t.botBg="#f8f9fa":this.isDarkColor(t.botBg)&&this.isDarkColor(t.text)&&(t.botBg="#e2e8f0"),this.isColorTooSimilar(t.primary,t.background)&&(t.primary=this.isLightColor(t.background)?"#4299e1":"#63b3ed"),t}},{key:"isLightColor",value:function(t){if(!t||"transparent"===t)return!0;if(t.startsWith("#")){var e=t.slice(1);return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>155}return!0}},{key:"isDarkColor",value:function(t){return!this.isLightColor(t)}},{key:"isColorTooSimilar",value:function(t,e){if(!(t&&e&&t.startsWith("#")&&e.startsWith("#")))return!1;var n=t.slice(1),a=e.slice(1),r=parseInt(n.substr(0,2),16),o=parseInt(n.substr(2,2),16),i=parseInt(n.substr(4,2),16),s=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),l=parseInt(a.substr(4,2),16);return Math.sqrt(Math.pow(s-r,2)+Math.pow(c-o,2)+Math.pow(l-i,2))<100}},{key:"autoDetectAndLoadTheme",value:(e=n(i().m(function t(e){return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,"default"!==this.options.themeStyle){t.n=1;break}return t.a(2,!1);case 1:return t.n=2,this.loadWebsiteTheme(e);case 2:if(!t.v){t.n=3;break}return this.options.themeStyle="website",t.a(2,!0);case 3:return this.options.themeStyle="default",this.websiteTheme=null,this.createStyles(),t.a(2,!1);case 4:t.n=6;break;case 5:return t.p=5,t.v,this.options.themeStyle="default",this.websiteTheme=null,this.createStyles(),t.a(2,!1);case 6:return t.a(2)}},t,this,[[0,5]])})),function(t){return e.apply(this,arguments)})},{key:"loadWebsiteTheme",value:(t=n(i().m(function t(e){var n,a,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,n=(new Date).getTime(),t.n=1,fetch("".concat(this.baseUrl,"/theme/").concat(e,"?t=").concat(n),{method:"GET",headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});case 1:return a=t.v,t.n=2,a.json();case 2:if(!((r=t.v).success&&r.data&&r.data.colors)){t.n=3;break}return this.websiteTheme=r.data,this.createStyles(),t.a(2,!0);case 3:return t.a(2,!1);case 4:t.n=6;break;case 5:return t.p=5,t.v,t.a(2,!1);case 6:return t.a(2)}},t,this,[[0,5]])})),function(e){return t.apply(this,arguments)})},{key:"darkenColor",value:function(t,e){if(!t||!t.startsWith("#"))return t;var n=t.slice(1),a=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),o=parseInt(n.substr(4,2),16),i=(100-e)/100,s=Math.round(a*i),c=Math.round(r*i),l=Math.round(o*i);return"#".concat(s.toString(16).padStart(2,"0")).concat(c.toString(16).padStart(2,"0")).concat(l.toString(16).padStart(2,"0"))}},{key:"lightenColor",value:function(t,e){if(!t||!t.startsWith("#"))return t;var n=t.slice(1),a=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),o=parseInt(n.substr(4,2),16),i=e/100,s=Math.round(a+(255-a)*i),c=Math.round(r+(255-r)*i),l=Math.round(o+(255-o)*i);return"#".concat(s.toString(16).padStart(2,"0")).concat(c.toString(16).padStart(2,"0")).concat(l.toString(16).padStart(2,"0"))}},{key:"adjustColorBrightness",value:function(t,e){if(!t||!t.startsWith("#"))return t;t=t.replace("#","");var n=parseInt(t,16),a=Math.round(2.55*e),r=(n>>16)+a,o=(n>>8&255)+a,i=(255&n)+a;return"#"+(16777216+65536*(r<255?r<1?0:r:255)+256*(o<255?o<1?0:o:255)+(i<255?i<1?0:i:255)).toString(16).slice(1)}}]);var t,e,s,c,l,h,u,d,p}();function h(){var t=document.querySelectorAll("script[data-api-key]"),e=t[t.length-1];if(e){var n=e.getAttribute("data-api-key");if(n){var a={baseUrl:e.getAttribute("data-base-url")||void 0};try{var r=new l(n,a);window.ChatFlowAI=r;var o=new CustomEvent("chatflow-ready",{detail:{chatbot:r}});document.dispatchEvent(o)}catch(t){}}}}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h(),t.ChatBot=l,t.default=l,t.initializeChatBot=h,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
